{% load static %}
<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}?version=3">
  <link rel="stylesheet" type="text/css" href="{% static 'css/overlay.css' %}?version=3">
  <link rel="stylesheet" type="text/css" href="{% static 'css/button.css' %}?version=3">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amatic+SC&display=swap">

  <script src="{% static 'lib/min/vs/loader.js' %}?version=3"></script>
  <script src="{% static 'js/overlay.js' %}?version=3"></script>
  <script>
    window.onload = setInit;

    const currentProtocol = window.location.protocol;

    // 적절한 프로토콜에 따라 웹소켓 주소 설정
    const webSocketProtocol = (currentProtocol === 'https:') ? 'wss://lambdathunder.xyz/socket.io' : 'ws://lambdathunder.xyz:8000';

    const webSocket = new WebSocket(webSocketProtocol);

    require.config({
      paths: {
        'vs' : "{% static 'lib/min/vs' %}"
      }
    });

    require(["vs/editor/editor.main"], () => {
      var editor = monaco.editor.create(document.getElementById('container'), {
        value: `def main(a):\n\tprint(a*5)\n\treturn a*2`,
        language: 'python',
        theme: 'vs-dark',
        scrollBeyondLastLine: false,
        minimap: { enabled: false },
      });
      window.logEditorValue = function() {
        var code = editor.getValue();
        var args = getValues();
        var json_data = {
          CODE : code,
          ARGS : args
        };
        var jsonString = JSON.stringify(json_data, null, 2);
        webSocket.send(jsonString);
      };
    });
    webSocket.onmessage = function(event) {
      const receivedMessage = event.data;
      const rt = document.getElementById('return');
      rt.innerHTML = show_json(receivedMessage);
    };

    function goBack() {
        window.history.back();
    };
  </script>

<script>
    function goToList2() {
        window.location.href = "{% url 'list2' %}";
    }
</script>

</head>
<body>
  <!-- Top Bar -->
   <div class="bar1" id="TopBar1">
    <p class="description">Code editor_Lambda-thunder</p>
  </div>

  <!-- End of Top Bar -->

  <!-- Middle Bar -->
  <div class="bar1" id="MiddleBar1">
  <button class="custom-btn btn-12" onclick="goToList2()"><span>Click!</span><span>이전페이지로 돌아가기</span></button>
  </div>
  <!-- End of Middle Bar -->

  <!-- Overlay Area -->
  <div id="overlay" class="overlay">
    <div class="overlay-content">
      <div id="table-container">
        <table id="myTable">
          <thead>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <p>
      <div class="container">
  <a class="button" href="#" style="--color:#1e9bff;" onclick="addRow()">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    행추가
  </a>
  <a class="close-btn button" href="#" style="--color: #ff1867;" onclick="closeOverlay()">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    닫기
  </a>
  {% comment %} <button class="close-btn" onclick="closeOverlay()">닫기</button> {% endcomment %}
</div>
        {% comment %} <button onclick="addRow()">행 추가</button>
        <button class="close-btn" onclick="closeOverlay()">
          닫기
        </button> {% endcomment %}
      </p>
    </div>
  </div>
  <!-- End of Overlay Area -->

  <!-- Grid Area -->
  <div class="case">
    <div class="grid"  id="resizableGrid">
      <div class="item merged">
        <p class="text">
          아에이오우<br>
        </p>
      </div>
      <div class="code">
        <div id="container"></div>
      </div>
      <div class="item text" id="return">
      </div>
    </div>
  </div>
  <!-- End of Grid Area -->

  <!-- Under Bar -->
  <div class="bar1 under1" id="UnderBar1">
    <button class="custom-btn btn-12" onclick="logEditorValue()" id="submit">
      <span>Click!</span><span>제출하기</span>
    </button>
    <button class="custom-btn btn-12" onclick="openOverlay()">
      <span>Click!</span><span>오버레이 열기</span>
    </button>
  </div>
  <!-- End of Under Bar -->
</body>
